## 前言
本次gmall-realtime开发只涉及 ods dim dwd dws
至于ads实时和离线不一样，离线的需要落盘需要单独开发，但是实时中直接和可视化结合，无需提前聚合也会更加灵活。
**数据仓库&&数据库**
1.数仓与数据库的区别：数仓处理历史数据，数据库只看最新数据。
2.数仓的核心架构：包括业务数据和用户行为数据。
![](imge/md-20250111095411.png)
- nginx负载均衡
- 对于日志数据先落盘（当然MongoDB 是一个基于文档的数据库，特别适合存储 JSON 格式的数据，并且在游戏开发中被广泛使用。）
- 日志数据通过flume kafka（缓冲）进入Hadoop
- 业务数据也增量全量地进入Hadoop


至此上面的部分和离线内容基本一样
对于实时
- 计算变成了flink，上图的clickhouse在该项目应该是doris
- 数据到了kakfa就相当于到了ods 所有的表进入到一个topic
- 维度表过滤出来存入dim层（存到哪）
- DWD层事实表存储在DWD层，DWS层：小批量汇总在DWS层。
详情见下图
![](imge/md-20250111100738.png)

**建模**
- ER 模型避免冗余节约资源
![](imge/md-20250111102612.png)
![](imge/md-20250111102726.png)
![](imge/md-20250111102741.png)
这种建模方法的出发点是整合数据，其目的是将整个企业的数据进行组合和合并，并进
行规范处理，减少数据冗余性，保证数据的一致性。这种模型并不适合直接用于分析统计。
- 维度模型
维度建模将数据表分为事实表和维度表，事实表存储业务过程数据，维度表存储描述性数据。
  - 1.事实表：细长，列少但数据量大，存储业务过程数据。
    - 1.事务型事实表：每条数据记录一个业务事件，如订单。（实时只用这个）
    - 2.周期快照事实表：每日或定期全量数据，如每日销售数据。
    - 3.累计快照事实表：类似于周期快照，但包含更多历史数据。
  - 2.维度表：宽表，存储描述性数据，如用户信息、商品信息等。

设计事务事实表时一般可遵循以下四个步骤：
选择业务过程→声明粒度→确认维度→确认事实

1.选择业务过程：确定感兴趣的业务分析点。通常情况下，
一个业务过程对应一张事务型事实表。
2.声明力度：选择最细力度，确保聚合的灵活性。
3.确定维度：确定表与哪些维度相关，选择合适的维度。尽量多
4.确定事实：确定表需要哪些指标，选择合适的度量值。


**不足**
1. 存量型指标
假设我们有一个电商平台，用户可以获取和使用虚拟货币。我们有两张事务型事实表：
获取货币事实表：记录用户获取虚拟货币的所有操作。
使用货币事实表：记录用户使用虚拟货币的所有操作。
现在我们需要统计每个用户截至当日的虚拟货币余额。为了计算余额，我们需要：
从 获取货币事实表 中获取每个用户的总获取金额。
从 使用货币事实表 中获取每个用户的总使用金额。
用总获取金额减去总使用金额，得到每个用户的余额。
这种方法需要对两张表进行全表扫描和聚合，逻辑复杂且效率低下。

2. 多事务关联统计
假设我们需要统计最近 30 天内用户从下单到支付的平均时间间隔。我们有两张事务型事实表：
下单事实表：记录用户的下单操作。
支付事实表：记录用户的支付操作。
为了计算平均时间间隔，我们需要：
从 下单事实表 中筛选出最近 30 天的下单记录。
从 支付事实表 中筛选出最近 30 天的支付记录。
按照订单 ID 将两张表进行关联，计算每个订单的支付时间减去下单时间。
计算所有订单的时间间隔的平均值。
这种方法需要对两张大表进行关联操作，效率较低。

### 数仓设计
![](imge/md-20250112093103.png)
1.数据调研：明确业务需求和数据域。业务调研和需求分析，划分数据域的意义是便于数据的管理和应用（数据域是对数据的分类，主题域和业务域是对业务的分类。
主题域和数据域最终都是对数据的分类，只是一个是数据视角，一个是业务视角。）
![](imge/md-20250112094300.png)
![](imge/md-20250112094426.png)
2.业务建模：构建业务主题矩阵。矩阵的行是一个个业务过程，矩阵的列是一个个的维度，行列的交点表示
业务过程与维度的关系。
3.指标明确：明确统计指标。
![](imge/md-20250112095345.png)
4.模型设计：包括汇总模型设计。一张汇总表通常包含业务过程相同、统计周期相同、统计粒度相同的多个
派生指标。
5.开发调度：完成数据开发和调度。
![](imge/md-20250112093252.png)